<!DOCTYPE html>
<html lang="id">
<head><meta name="google-site-verification" content="3eEt-BDrNTx1-ZYFwGEB-5hvz73i71dSlG8w93NjZeg" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mj-Shop Alam Gambar</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{
  background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1950&q=80') no-repeat center center fixed;
  background-size: cover;
  color:#fff;
  overflow-x:hidden;
  padding-bottom:160px; /* biar space buat bio-link bawah + footer */
}
header, footer{
  position: fixed; left:0; right:0; width:100%;
  background: rgba(200, 180, 150, 0.85);
  padding: 10px; text-align:center;
  box-shadow: 0 5px 15px rgba(0,0,0,.2);
  z-index:999; color:#fff;
}
header h2{font-size:24px;cursor:pointer;margin-bottom:6px;}
nav{display:flex;justify-content:center;gap:6px;flex-wrap:wrap;}
nav a{
  padding:5px 8px;border-radius:6px;text-decoration:none;color:#fff;font-weight:bold;font-size:13px;
  white-space:nowrap;cursor:pointer;
  background: rgba(58,166,85,0.8);
  transition:0.3s;
}
nav a:hover{transform: scale(1.1);background: rgba(245,230,166,0.8);}
footer{bottom:0;font-size:12px;}
section{
  display:none;
  padding:160px 10px 60px; /* biar header nggak nutup clickable area */
  max-width:1000px;
  margin:0 auto;
}
section.active{display:block;}
.slider{display:flex;overflow-x:auto;gap:10px;scroll-behavior:smooth;padding:10px 0;}
.slider::-webkit-scrollbar{height:6px;}
.slider::-webkit-scrollbar-thumb{background: rgba(58,166,85,0.8); border-radius:4px;}
.card{
  background: rgba(255,255,255,0.85);
  color:#333;
  padding:10px;
  border-radius:12px;
  cursor:pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,.12);
  transition:0.4s;
  min-width:180px; flex:0 0 auto;
}
.card:hover{transform: translateY(-5px) scale(1.03);box-shadow:0 10px 20px rgba(0,0,0,.18);}
.card img{width:100%;height:150px;object-fit:cover;border-radius:6px;transition:0.3s;}
.card img:hover{transform:scale(1.05);}
.btn{
  background: linear-gradient(135deg,#3aa655,#d1b280);
  color:#fff;
  padding:6px 10px;
  border-radius:6px;
  border:none;
  cursor:pointer;
  margin-top:6px;
  font-size:13px;
  transition:0.4s;
}
.btn-danger{background:red;}
.btn:hover{transform: scale(1.05) rotate(-1deg);opacity:0.9;}
input,textarea,select{width:100%;padding:6px;margin-top:6px;font-size:13px;}
textarea{resize:none;}
.cart-box{background: rgba(255,255,255,0.85); color:#333; padding:10px;border-radius:8px;margin:10px 0; box-shadow:0 3px 8px rgba(0,0,0,.15);}
#popup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:1000;}
#popup .box{background: rgba(255,255,255,0.95); padding:15px;border-radius:10px;max-width:400px;width:90%;max-height:80%;overflow:auto;position:relative;}
#popup .close{position:absolute;top:6px;right:10px;font-size:18px;cursor:pointer;}
.bio-link-bottom{
  position: fixed;
  bottom:40px; /* di atas footer */
  left:50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.6);
  padding:10px 15px;
  border-radius:12px;
  display:flex;
  gap:10px;
  z-index:999;
}
.bio-link-bottom a{
  display:flex;
  align-items:center;
  gap:4px;
  color:#fff;
  text-decoration:none;
  font-size:13px;
  transition:0.3s;
}
.bio-link-bottom a:hover{transform: scale(1.1);}
.bio-link-bottom img{width:20px;height:20px;}
section h3{color:#3aa655;margin-bottom:10px;}
@media(max-width:768px){.card{min-width:140px}.card img{height:120px;} header h2{font-size:20px;}}
@media(min-width:1024px){.card{min-width:200px}.card img{height:220px};}
</style>
</head>
<body>

<header>
<h2 onclick="showPage('home')">Mj-Shop</h2>
<nav>
<a onclick="showPage('home')">Home</a>
<a onclick="showPage('produk')">Produk</a>
<a onclick="showPage('artikel')">Artikel</a>
<a onclick="showPage('testimoni')">Testimoni</a>
<a onclick="showPage('cart')">Keranjang</a>
<a onclick="showPage('admin')">Admin</a>
</nav>
</header>

<section id="home" class="active">
<h3>Produk Terbaru</h3><div class="slider" id="homeProduk"></div>
<h3>Artikel Terbaru</h3><div class="slider" id="homeArtikel"></div>
<h3>Testimoni Pelanggan</h3><div class="slider" id="homeTestimoni"></div>
</section>

<section id="produk">
<h3>Produk</h3>
<label>Filter Kategori</label>
<select id="filterKategori" onchange="filterProduk()">
<option value="all">Semua</option>
<option value="fashion">Fashion</option>
<option value="rumah">Rumah</option>
<option value="gadget">Gadget</option>
<option value="lain">Lain-lain</option>
</select>
<div id="produkList"></div>
</section>

<section id="artikel"><h3>Artikel</h3><div id="artikelList"></div></section>
<section id="testimoni"><h3>Testimoni</h3><div id="testimoniList"></div></section>

<section id="cart">
<h3>Keranjang Belanja</h3>
<div class="cart-box" id="cartList">Belum ada produk di keranjang</div>
<button class="btn btn-danger" onclick="checkout()">Checkout via WhatsApp</button>
</section>

<section id="admin">
<h3>Admin Panel üîê</h3>
<div id="loginBox">
<input id="adminEmail" placeholder="Email admin">
<input id="adminPassword" type="password" placeholder="Password">
<button class="btn" onclick="loginAdmin()">Login</button>
</div>

<div id="adminBox" style="display:none">
<button class="btn btn-danger" style="margin-bottom:10px;" onclick="logoutAdmin()">Logout</button>

<h4>Tambah Produk</h4>
<input id="pnama" placeholder="Nama Produk">
<select id="pkategori">
<option value="fashion">Fashion</option>
<option value="rumah">Rumah</option>
<option value="gadget">Gadget</option>
<option value="lain">Lain-lain</option>
</select>
<input type="number" id="pstok" placeholder="Stok" min="0">
<input type="file" id="pfile" accept="image/jpeg,image/png,image/webp,image/gif,image/bmp,image/tiff">
<button class="btn" onclick="tambahProduk()">Tambah Produk</button>

<h4>Tambah Artikel</h4>
<input id="anama" placeholder="Judul Artikel">
<textarea id="aisi" placeholder="Isi Artikel"></textarea>
<input type="file" id="afile" accept="image/jpeg,image/png,image/webp,image/gif,image/bmp,image/tiff">
<button class="btn" onclick="tambahArtikel()">Tambah Artikel</button>

<h4>Tambah Testimoni</h4>
<input id="tnama" placeholder="Nama Pelanggan">
<textarea id="tisi" placeholder="Isi Testimoni"></textarea>
<input type="file" id="tfile" accept="image/jpeg,image/png,image/webp,image/gif,image/bmp,image/tiff">
<button class="btn" onclick="tambahTestimoni()">Tambah Testimoni</button>
</div>
</section>

<!-- BIO-LINK ICON BAWAH -->
<div class="bio-link-bottom">
  <a href="https://wa.me/6285691451094" target="_blank">
    <img src="https://img.icons8.com/ios-filled/24/ffffff/whatsapp.png"/> WhatsApp
  </a>
  <a href="https://instagram.com/mjshop" target="_blank">
    <img src="https://img.icons8.com/ios-filled/24/ffffff/instagram-new.png"/> Instagram
  </a>
  <a href="https://t.me/mjshop" target="_blank">
    <img src="https://img.icons8.com/ios-filled/24/ffffff/telegram-app.png"/> Telegram
  </a>
  <a href="https://tiktolk.com/@mj_shop91" target="_blank">
    <img src="https://img.icons8.com/ios-filled/24/ffffff/tiktok.png"/> TikTok
  </a>
  <a href="https://www.facebook.com/profile.php?id=61585424703436" target="_blank">
    <img src="https://img.icons8.com/ios-filled/24/ffffff/facebook-new.png"/> Facebook
  </a>
</div>

<footer>¬© Mj-Shop ‚Ä¢ Order via WhatsApp</footer>

<div id="popup"><div class="box"><span class="close" onclick="popup.style.display='none'">‚úñ</span><div id="popupContent"></div></div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, query, orderBy, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";

const firebaseConfig={apiKey:"AIzaSyD3OBIuIqu5C9zCO_CexO4wIVLjX1Hf3vU",authDomain:"mj-shop-2d1e0.firebaseapp.com",projectId:"mj-shop-2d1e0",storageBucket:"mj-shop-2d1e0.appspot.com",messagingSenderId:"592598529202",appId:"1:592598529202:web:98f1777ca3cda7e69a45ab"};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const storage=getStorage(app);

let isAdmin=false, cart=[], produkCache=[], artikelCache=[], testimoniCache=[];
const loginBox=document.getElementById("loginBox"), adminBox=document.getElementById("adminBox");
const popup=document.getElementById("popup"), popupContent=document.getElementById("popupContent");
const MAX_SIZE = 10 * 1024 * 1024; // 10MB

window.showPage=id=>{document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));document.getElementById(id).classList.add("active");};

// LOGIN / LOGOUT
window.loginAdmin=()=>signInWithEmailAndPassword(auth,adminEmail.value,adminPassword.value).catch(e=>alert(e.message));
window.logoutAdmin=()=>signOut(auth).catch(e=>alert(e.message));

onAuthStateChanged(auth,user=>{
  if(user){loginBox.style.display="none"; adminBox.style.display="block"; isAdmin=true;}
  else{loginBox.style.display="block"; adminBox.style.display="none"; isAdmin=false;}
});

// ================= ADMIN TAMBAH =================
window.tambahProduk=async()=>{
  const nama=pnama.value.trim(), kategori=pkategori.value, stok=parseInt(pstok.value)||0;
  const file=pfile.files[0];
  if(!nama || !file) return alert("Isi nama & pilih gambar");
  if(!file.type.startsWith("image/")) return alert("Hanya file gambar yang diperbolehkan");
  if(file.size>MAX_SIZE) return alert("Ukuran gambar maksimal 10MB");
  const uniqName=Date.now()+"-"+file.name;
  const storageRef=ref(storage,"produk/"+uniqName);
  await uploadBytes(storageRef,file);
  const gambar=await getDownloadURL(storageRef);
  await addDoc(collection(db,"produk"),{nama,kategori,stok,gambar,created:Date.now()});
  pnama.value=""; pstok.value=""; pfile.value="";
};

window.tambahArtikel=async()=>{
  const judul=anama.value.trim(), isi=aisi.value.trim();
  const file=afile.files[0];
  if(!judul || !isi) return alert("Isi judul & isi artikel");
  let gambar="";
  if(file){
    if(!file.type.startsWith("image/")) return alert("Hanya file gambar yang diperbolehkan");
    if(file.size>MAX_SIZE) return alert("Ukuran gambar maksimal 10MB");
    const uniqName=Date.now()+"-"+file.name;
    const storageRef=ref(storage,"artikel/"+uniqName);
    await uploadBytes(storageRef,file);
    gambar=await getDownloadURL(storageRef);
  }
  await addDoc(collection(db,"artikel"),{judul,isi,gambar,created:Date.now()});
  anama.value=""; aisi.value=""; afile.value="";
};

window.tambahTestimoni=async()=>{
  const nama=tnama.value.trim(), isi=tisi.value.trim();
  const file=tfile.files[0];
  if(!nama || !isi) return alert("Isi nama & isi testimoni");
  let gambar="";
  if(file){
    if(!file.type.startsWith("image/")) return alert("Hanya file gambar yang diperbolehkan");
    if(file.size>MAX_SIZE) return alert("Ukuran gambar maksimal 10MB");
    const uniqName=Date.now()+"-"+file.name;
    const storageRef=ref(storage,"testimoni/"+uniqName);
    await uploadBytes(storageRef,file);
    gambar=await getDownloadURL(storageRef);
  }
  await addDoc(collection(db,"testimoni"),{nama,isi,gambar,created:Date.now()});
  tnama.value=""; tisi.value=""; tfile.value="";
};

// ================= RENDER =================
const renderSlider = (items, el)=>{
  el.innerHTML="";
  items.forEach(data=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`${data.gambar?`<img src="${data.gambar}">`:""}<b>${data.nama||data.judul||data.nama}</b><p>${data.isi||''}</p>${data.stok!=undefined?'<br>Stok:'+data.stok:''}${data.qty?`<br>Qty:${data.qty}`:''}${isAdmin&&data.id?`<br><button class="btn btn-danger" onclick="hapusData('${data.id}','${el.id}')">Hapus</button>`:""}<br>${data.stok!=undefined?`<button class="btn" onclick="addCart('${data.id}')">Tambah Keranjang</button>`:""}`;
    
    card.querySelectorAll("button").forEach(btn=>btn.addEventListener("click",e=>e.stopPropagation()));
    card.addEventListener("click",()=>showPopupDetail(data));
    el.appendChild(card);
  });
};

// ================= POPUP =================
const showPopupDetail=data=>{
  popupContent.innerHTML="";
  if(data.gambar) popupContent.innerHTML+=`<img src="${data.gambar}" style="width:100%;border-radius:6px;margin-bottom:6px;">`;
  if(data.nama) popupContent.innerHTML+=`<b>${data.nama}</b><p>Stok:${data.stok||"-"}</p>`;
  if(data.judul) popupContent.innerHTML+=`<b>${data.judul}</b><p>${data.isi}</p>`;
  popup.style.display="flex";
};

// ================= HAPUS DATA =================
window.hapusData=async(id,elId)=>{
  if(confirm("Yakin mau hapus?")){
    const col = elId.includes("Produk")||elId==="produkList"?"produk":elId.includes("Artikel")||elId==="artikelList"?"artikel":"testimoni";
    await deleteDoc(doc(db,col,id));
  }
};

// ================= KERANJANG =================
window.addCart=id=>{
  const prod=produkCache.find(p=>p.id===id); 
  if(!prod) return; 
  let found=cart.find(c=>c.id===id); 
  if(found) found.qty++; 
  else cart.push({...prod,qty:1}); 
  updateCart();
};
const updateCart=()=>{
  const cl=document.getElementById("cartList"); 
  if(cart.length===0){cl.innerHTML="Belum ada produk di keranjang"; return;} 
  cl.innerHTML=""; 
  cart.forEach(p=>{
    const div=document.createElement("div"); 
    div.className="card"; 
    div.innerHTML=`<b>${p.nama}</b> (x${p.qty})`; 
    cl.appendChild(div);
  });
};
window.checkout=async()=>{
  if(cart.length===0) return alert("Keranjang kosong");
let msg="Order Produk:\n";
// cek stok
for(const p of cart){
  const prodRef=produkCache.find(pr=>pr.id===p.id); 
  if(prodRef && prodRef.stok<p.qty){alert(`Stok ${p.nama} kurang!`); return;}
}
// kurangi stok & simpan transaksi
for(const p of cart){
  msg+=`${p.nama} x${p.qty}\n`; 
  const prodRef=produkCache.find(pr=>pr.id===p.id); 
  if(prodRef) await updateDoc(doc(db,"produk",p.id),{stok:prodRef.stok-p.qty}); 
  await addDoc(collection(db,"transaksi"),{produk:p.nama,qty:p.qty,tanggal:serverTimestamp()});
}
cart=[]; 
updateCart(); 
window.open(`https://wa.me/6285691451094?text=${encodeURIComponent(msg)}`);
};

// ================= FILTER =================
const filterProduk=()=>{
  const val=document.getElementById("filterKategori").value;
  let items=produkCache;
  if(val!=="all") items=produkCache.filter(p=>p.kategori===val);
  renderSlider(items, document.getElementById("produkList"));
};

// ================= SNAPSHOT REALTIME =================
onSnapshot(query(collection(db,"produk"),orderBy("created","desc")),(snap)=>{
  produkCache=snap.docs.map(d=>({id:d.id,...d.data()}));
  renderSlider(produkCache,document.getElementById("homeProduk"));
  renderSlider(produkCache,document.getElementById("produkList"));
});
onSnapshot(query(collection(db,"artikel"),orderBy("created","desc")),(snap)=>{
  artikelCache=snap.docs.map(d=>({id:d.id,...d.data()}));
  renderSlider(artikelCache,document.getElementById("homeArtikel"));
  renderSlider(artikelCache,document.getElementById("artikelList"));
});
onSnapshot(query(collection(db,"testimoni"),orderBy("created","desc")),(snap)=>{
  testimoniCache=snap.docs.map(d=>({id:d.id,...d.data()}));
  renderSlider(testimoniCache,document.getElementById("homeTestimoni"));
  renderSlider(testimoniCache,document.getElementById("testimoniList"));
});

// ================= SLIDER SCROLL & ESC =================
document.querySelectorAll('.slider').forEach(sl=>{
  sl.addEventListener('wheel',e=>{
    e.preventDefault();
    sl.scrollLeft += e.deltaY;
  });
});
document.addEventListener('keydown', e => {
  if (e.key === "Escape") popup.style.display = "none";
});
</script>
</body>
</html>
